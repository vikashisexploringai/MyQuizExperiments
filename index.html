<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz Page</title>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --error-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
        }
        .quiz-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 2rem;
        }
        .hidden { display: none; }
        .question {
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            background: white;
            border-left: 5px solid var(--primary-color);
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .question:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .question.correct {
            border-color: var(--success-color);
            background-color: rgba(76, 201, 240, 0.05);
        }
        .question.wrong {
            border-color: var(--error-color);
            background-color: rgba(247, 37, 133, 0.05);
        }
        .choices {
            margin-bottom: 10px;
        }
        .custom-radio {
            position: relative;
            display: block;
            margin: 10px 0;
        }
        .custom-radio input[type="radio"] {
            opacity: 0;
            position: absolute;
            left: 0;
            top: 0;
            width: 22px;
            height: 22px;
            z-index: 2;
            cursor: pointer;
        }
        .custom-radio label {
            display: inline-block;
            position: relative;
            padding-left: 35px;
            cursor: pointer;
            user-select: none;
            font-size: 1em;
            transition: var(--transition);
            background: var(--light-color);
            border-radius: 8px;
            padding-top: 8px;
            padding-bottom: 8px;
            min-height: 30px;
            width: 100%;
        }
        .custom-radio label:hover {
            background: #e9ecef;
        }
        .custom-radio label::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            background: #fff;
            transition: var(--transition);
        }
        .custom-radio input[type="radio"]:checked + label::before {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: inset 0 0 0 5px #fff;
        }
        .custom-radio input[type="radio"]:focus + label::before {
            outline: 2px solid var(--secondary-color);
        }
        .explanation {
            margin-top: 15px;
            font-size: 0.95em;
            color: #495057;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        .btn {
            padding: 12px 24px;
            margin: 10px 5px 0 0;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .quiz-options, .theme-list {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
        }
        select, input[type="radio"] {
            margin-right: 8px;
        }
        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ced4da;
            background: white;
            font-size: 1em;
            margin-left: 10px;
        }
        label {
            display: inline-block;
            margin-right: 15px;
            cursor: pointer;
        }
        #result {
            padding: 20px;
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            text-align: center;
        }
        #result h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        @media (max-width: 768px) {
            .quiz-container {
                margin: 20px;
                padding: 20px;
            }
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
<div class="quiz-container">
    <h2>Quiz</h2>
    <div id="themeSelection" class="theme-list">
        <label for="theme">Choose a theme:</label>
        <select id="theme">
            <option value="" disabled selected>Select theme</option>
        </select>
    </div>
    <div id="quizOptions" class="quiz-options hidden">
        <label>Number of Questions:
            <select id="numQuestions">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="all">Complete Set</option>
            </select>
        </label>
        <br>
        <label>Quiz Mode:</label>
        <label><input type="radio" name="mode" value="onebyone" checked> One by One</label>
        <label><input type="radio" name="mode" value="all"> All on Same Page</label>
        <br>
        <button id="startQuizBtn" class="btn">Start Quiz</button>
    </div>
    <form id="quizForm" class="hidden">
        <div id="questionsContainer"></div>
        <button id="submitQuizBtn" class="btn" type="submit">Submit</button>
    </form>
    <div id="result" class="hidden"></div>
</div>
<script>
// --- Config ---
const THEMES = [
    { name: "Battles", file: "themes/battles.json" },
    { name: "Contemporary History", file: "themes/contemporaryHistory.json" },
    { name: "Modern History", file: "themes/modernHistory.json" }
];

// --- UI Elements ---
const themeSelect = document.getElementById('theme');
const quizOptions = document.getElementById('quizOptions');
const startQuizBtn = document.getElementById('startQuizBtn');
const quizForm = document.getElementById('quizForm');
const questionsContainer = document.getElementById('questionsContainer');
const resultDiv = document.getElementById('result');
const numQuestionsSelect = document.getElementById('numQuestions');

// --- State ---
let questions = [];
let quizMode = 'onebyone';
let currentQuestionIndex = 0;
let userAnswers = [];
let quizStarted = false;

// --- Populate theme selector ---
function populateThemes() {
    THEMES.forEach(theme => {
        const opt = document.createElement('option');
        opt.value = theme.file;
        opt.textContent = theme.name;
        themeSelect.appendChild(opt);
    });
}
populateThemes();

// --- Theme selection handler ---
themeSelect.addEventListener('change', () => {
    quizOptions.classList.remove('hidden');
    quizForm.classList.add('hidden');
    resultDiv.classList.add('hidden');
    // Reset state
    questions = [];
    userAnswers = [];
    quizStarted = false;
});

// --- Quiz Mode handler ---
quizOptions.addEventListener('change', (e) => {
    if (e.target.name === "mode") {
        quizMode = e.target.value;
    }
});

// --- Start Quiz handler ---
startQuizBtn.addEventListener('click', async () => {
    const themeFile = themeSelect.value;
    if (!themeFile) return;
    questions = await fetch(themeFile).then(res => res.json());
    let count = numQuestionsSelect.value === "all" ? questions.length : parseInt(numQuestionsSelect.value);
    questions = shuffle(questions).slice(0, count);
    userAnswers = new Array(questions.length).fill(null);
    currentQuestionIndex = 0;
    quizStarted = true;
    resultDiv.classList.add('hidden');
    if (quizMode === "all") {
        renderAllQuestions();
    } else {
        renderOneByOne();
    }
    quizForm.classList.remove('hidden');
});

// --- Shuffle Utility ---
function shuffle(array) {
    return array.map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);
}

// --- Render All Questions ---
function renderAllQuestions(showAnswers = false) {
    questionsContainer.innerHTML = '';
    questions.forEach((q, idx) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question' + (showAnswers ? (userAnswers[idx] === q.answer ? ' correct' : ' wrong') : '');
        questionDiv.innerHTML = `
            <div><b>Q${idx+1}:</b> ${q.question}</div>
            <div class="choices">
                ${q.choices.map((choice, cidx) => `
                    <div class="custom-radio">
                        <input type="radio" id="q${idx}a${cidx}" name="q${idx}" value="${choice}" ${userAnswers[idx] === choice ? "checked" : ""} ${showAnswers ? "disabled" : ""}>
                        <label for="q${idx}a${cidx}">${choice}</label>
                    </div>
                `).join('')}
            </div>
            <div class="explanation" style="display:${showAnswers ? "block" : "none"};">
                <b>Explanation:</b> ${q.explanation}
            </div>
        `;
        questionsContainer.appendChild(questionDiv);
    });
}

// --- Render One By One ---
function renderOneByOne(showAnswer = false) {
    questionsContainer.innerHTML = '';
    const q = questions[currentQuestionIndex];
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question' + (showAnswer ? (userAnswers[currentQuestionIndex] === q.answer ? ' correct' : ' wrong') : '');
    questionDiv.innerHTML = `
        <div><b>Q${currentQuestionIndex+1}:</b> ${q.question}</div>
        <div class="choices">
            ${q.choices.map((choice, cidx) => `
                <div class="custom-radio">
                    <input type="radio" id="q${currentQuestionIndex}a${cidx}" name="q${currentQuestionIndex}" value="${choice}" ${userAnswers[currentQuestionIndex] === choice ? "checked" : ""} ${showAnswer ? "disabled" : ""}>
                    <label for="q${currentQuestionIndex}a${cidx}">${choice}</label>
                </div>
            `).join('')}
        </div>
        <div class="explanation" style="display:${showAnswer ? "block" : "none"};">
            <b>Explanation:</b> ${q.explanation}
        </div>
    `;
    questionsContainer.appendChild(questionDiv);

    // Prev/Next buttons
    const navDiv = document.createElement('div');
    if (currentQuestionIndex > 0)
        navDiv.innerHTML += `<button type="button" class="btn" id="prevBtn">Prev</button>`;
    if (currentQuestionIndex < questions.length - 1)
        navDiv.innerHTML += `<button type="button" class="btn" id="nextBtn">Next</button>`;
    questionsContainer.appendChild(navDiv);

    // Navigation handlers
    if (document.getElementById('prevBtn')) {
        document.getElementById('prevBtn').onclick = () => {
            saveCurrentAnswer();
            currentQuestionIndex--;
            renderOneByOne();
        };
    }
    if (document.getElementById('nextBtn')) {
        document.getElementById('nextBtn').onclick = () => {
            saveCurrentAnswer();
            currentQuestionIndex++;
            renderOneByOne();
        };
    }
}

// --- Save current answer (for onebyone mode) ---
function saveCurrentAnswer() {
    const radios = document.querySelectorAll(`input[name="${currentQuestionIndex}"]`);
    radios.forEach(radio => {
        if (radio.checked) userAnswers[currentQuestionIndex] = radio.value;
    });
}

// --- Handle Quiz Submission ---
quizForm.addEventListener('submit', function(e) {
    e.preventDefault();
    if (quizMode === "all") {
        // Save answers
        questions.forEach((q, idx) => {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            userAnswers[idx] = selected ? selected.value : null;
        });
        renderAllQuestions(true);
    } else {
        saveCurrentAnswer();
        renderOneByOne(true);
    }
    showResult();
});

// --- Show result ---
function showResult() {
    let correct = 0;
    questions.forEach((q, idx) => {
        if (userAnswers[idx] === q.answer) correct++;
    });
    resultDiv.innerHTML = `<h3>Result: ${correct}/${questions.length} correct</h3>`;
    resultDiv.classList.remove('hidden');
}
</script>
</body>
</html>
