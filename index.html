<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Historical Events Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --error-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .quiz-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        h1 {
            font-size: 2rem;
        }
        
        .active-screen {
            display: block;
        }
        
        .theme-screen, .length-screen, .quiz-screen, .results-screen {
            display: none;
        }
        
        .selection-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .selection-option {
            padding: 15px;
            border-radius: var(--border-radius);
            background: var(--light-color);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .selection-option:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }
        
        .selection-option input[type="radio"] {
            display: none;
        }
        
        .selection-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .theme-description {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .nav-buttons, .quiz-actions, .one-at-a-time-option {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .question {
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            background: white;
            border-left: 5px solid var(--primary-color);
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .question.correct {
            border-color: var(--success-color);
            background-color: rgba(76, 201, 240, 0.05);
        }
        
        .question.incorrect {
            border-color: var(--error-color);
            background-color: rgba(247, 37, 133, 0.05);
        }
        
        .question-text {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: var(--light-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .option:hover {
            background: #e9ecef;
        }
        
        .option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            display: none;
        }
        
        .show {
            display: block !important;
        }
        
        .score {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .quiz-container {
                margin: 20px;
                padding: 20px;
            }
            
            .selection-options {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons, .quiz-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="quiz-container">
    <h1>Important Dates Quiz</h1>

    <!-- Theme Selection Screen -->
    <div id="theme-screen" class="theme-screen active-screen">
        <h2>Choose Quiz Theme</h2>
        <div class="selection-options" id="theme-options"></div>
        <div class="nav-buttons">
            <button id="next-to-length">Next</button>
        </div>
    </div>

    <!-- Length Selection Screen -->
    <div id="length-screen" class="length-screen">
        <h2 id="length-screen-title">Choose Quiz Length</h2>
        <div class="selection-options" id="length-options"></div>
        <div class="nav-buttons">
            <button id="back-to-theme">Back</button>
            <button id="start-quiz">Start Quiz</button>
        </div>
        <div class="one-at-a-time-option">
            <button id="one-at-a-time">One Question At A Time</button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="quiz-screen">
        <div class="progress" id="progress"></div>
        <div id="quiz"></div>
        <div class="quiz-actions">
            <button id="submit-quiz">Submit Quiz</button>
            <button id="restart-quiz">Restart Quiz</button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="results-screen">
        <div class="score" id="final-score"></div>
        <div id="results"></div>
        <button id="restart">Take Another Quiz</button>
    </div>
</div>

<script>
// --- Theme/JSON Mapping ---
const THEMES = [
    { key: "battles", name: "Battles", description: "Important Battles and Treaties", file: "themes/battles.json" },
    { key: "modernHistory", name: "Modern History", description: "Modern India and World", file: "themes/modernHistory.json" },
    { key: "contemporary", name: "Contemporary India and World", description: "Post-independence India and World", file: "themes/contemporaryHistory.json" },
];

let selectedThemeKey = null;
let selectedQuestions = [];
let quizMode = 'all';
let currentQuestionIndex = 0;
let userAnswers = [];
let score = 0;

// --- DOM elements ---
const themeScreen = document.getElementById('theme-screen');
const lengthScreen = document.getElementById('length-screen');
const quizScreen = document.getElementById('quiz-screen');
const resultsScreen = document.getElementById('results-screen');
const themeOptionsContainer = document.getElementById('theme-options');
const lengthOptionsContainer = document.getElementById('length-options');
const nextToLengthButton = document.getElementById('next-to-length');
const backToThemeButton = document.getElementById('back-to-theme');
const startQuizButton = document.getElementById('start-quiz');
const oneAtATimeButton = document.getElementById('one-at-a-time');
const quizContainer = document.getElementById('quiz');
const submitQuizButton = document.getElementById('submit-quiz');
const restartQuizButton = document.getElementById('restart-quiz');
const finalRestartButton = document.getElementById('restart');
const progressContainer = document.getElementById('progress');
const resultsContainer = document.getElementById('results');
const finalScoreContainer = document.getElementById('final-score');

// --- Initialize theme options ---
function initializeThemeOptions() {
    themeOptionsContainer.innerHTML = '';
    THEMES.forEach(theme => {
        const div = document.createElement('div');
        div.className = 'selection-option';
        div.innerHTML = `
            <input type="radio" name="quizTheme" value="${theme.key}" id="theme-${theme.key}">
            <label for="theme-${theme.key}">
                <strong>${theme.name}</strong>
                <div class="theme-description">${theme.description}</div>
            </label>
        `;
        themeOptionsContainer.appendChild(div);
        
        // Add click handler for better mobile experience
        div.addEventListener('click', function() {
            document.querySelectorAll('.selection-option').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            document.getElementById(`theme-${theme.key}`).checked = true;
        });
    });
}
initializeThemeOptions();

// --- Length options ---
function initializeLengthOptions(questionsCount) {
    lengthOptionsContainer.innerHTML = '';
    [10, 20, 30].forEach(n => {
        if (n <= questionsCount) {
            const div = document.createElement('div');
            div.className = 'selection-option';
            div.innerHTML = `<input type="radio" name="quizLength" value="${n}" id="length-${n}">
                             <label for="length-${n}">${n} Questions</label>`;
            lengthOptionsContainer.appendChild(div);
            
            // Add click handler
            div.addEventListener('click', function() {
                document.querySelectorAll('.selection-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                document.getElementById(`length-${n}`).checked = true;
            });
        }
    });
    // Always add "Complete Set"
    const div = document.createElement('div');
    div.className = 'selection-option complete-set-option';
    div.innerHTML = `<input type="radio" name="quizLength" value="${questionsCount}" id="length-complete">
                     <label for="length-complete">Complete Set (${questionsCount} Questions)</label>`;
    lengthOptionsContainer.appendChild(div);
    
    // Add click handler
    div.addEventListener('click', function() {
        document.querySelectorAll('.selection-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('length-complete').checked = true;
    });
}

// --- Navigation ---
nextToLengthButton.addEventListener('click', async () => {
    const selected = document.querySelector('input[name="quizTheme"]:checked');
    if (!selected) { alert("Please select a theme!"); return; }
    selectedThemeKey = selected.value;
    // Fetch just to get count for options
    try {
        const theme = THEMES.find(t => t.key === selectedThemeKey);
        const response = await fetch(theme.file);
        if (!response.ok) throw new Error("Failed to fetch questions");
        const questions = await response.json();
        initializeLengthOptions(questions.length);
        themeScreen.classList.remove('active-screen');
        lengthScreen.classList.add('active-screen');
    } catch (error) {
        console.error("Error loading questions:", error);
        alert("Failed to load questions. Please try again.");
    }
});

backToThemeButton.addEventListener('click', () => {
    lengthScreen.classList.remove('active-screen');
    themeScreen.classList.add('active-screen');
});

// --- Start Quiz ---
startQuizButton.addEventListener('click', () => startQuiz('all'));
oneAtATimeButton.addEventListener('click', () => startQuiz('one'));

async function startQuiz(mode) {
    const selectedLen = document.querySelector('input[name="quizLength"]:checked');
    if (!selectedLen) { alert("Please select a quiz length!"); return; }
    quizMode = mode;
    currentQuestionIndex = 0;
    userAnswers = [];
    score = 0;
    
    try {
        // Fetch questions
        const theme = THEMES.find(t => t.key === selectedThemeKey);
        const response = await fetch(theme.file);
        if (!response.ok) throw new Error("Failed to fetch questions");
        let questions = await response.json();
        questions = shuffleArray(questions);
        selectedQuestions = questions.slice(0, parseInt(selectedLen.value));
        
        // Move to quiz screen
        lengthScreen.classList.remove('active-screen');
        quizScreen.classList.add('active-screen');
        resultsScreen.classList.remove('active-screen');
        showQuestions();
    } catch (error) {
        console.error("Error starting quiz:", error);
        alert("Failed to start quiz. Please try again.");
    }
}

// --- Shuffle utility ---
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length-1; i > 0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// --- Show Questions ---
function showQuestions() {
    progressContainer.textContent = `Question ${quizMode === 'one' ? (currentQuestionIndex + 1) : selectedQuestions.length} of ${selectedQuestions.length}`;
    if (quizMode === 'all') {
        let html = '';
        selectedQuestions.forEach((q, idx) => {
            html += `
                <div class="question" id="question-${idx}">
                    <div class="question-text"><strong>${idx + 1}. ${q.question}</strong></div>
                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option">
                                <input type="radio" name="question${idx}" value="${opt}" id="q${idx}option${i}">
                                <label for="q${idx}option${i}">${opt}</label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="explanation" id="explanation-${idx}">${q.explanation}</div>
                </div>
            `;
        });
        quizContainer.innerHTML = html;
        submitQuizButton.style.display = '';
        restartQuizButton.style.display = '';
    } else {
        showSingleQuestion();
        submitQuizButton.style.display = 'none';
        restartQuizButton.style.display = '';
    }
}

// --- One-by-one mode ---
function showSingleQuestion() {
    const q = selectedQuestions[currentQuestionIndex];
    quizContainer.innerHTML = `
        <div class="question" id="question-single">
            <div class="question-text"><strong>Question ${currentQuestionIndex + 1} of ${selectedQuestions.length}: ${q.question}</strong></div>
            <div class="options">
                ${q.options.map((opt, idx) => `
                    <div class="option">
                        <input type="radio" name="questionSingle" value="${opt}" id="qSingleOption${idx}">
                        <label for="qSingleOption${idx}">${opt}</label>
                    </div>
                `).join('')}
            </div>
            <div class="explanation" id="explanation-single" style="display:none;">${q.explanation}</div>
            <div class="quiz-actions" style="margin-top:20px;">
                <button id="submit-single">Submit Answer</button>
            </div>
        </div>
    `;
    document.getElementById('submit-single').onclick = checkSingleAnswer;
}

function checkSingleAnswer() {
    const q = selectedQuestions[currentQuestionIndex];
    const selected = document.querySelector('input[name="questionSingle"]:checked');
    const explanationElement = document.getElementById('explanation-single');
    
    if (!selected) { 
        alert('Please select an answer!'); 
        return; 
    }
    
    const userAnswer = selected.value;
    const isCorrect = userAnswer.replace(/\s+/g, '') === q.answer.replace(/\s+/g, '');
    userAnswers.push({ 
        question: q.question, 
        userAnswer, 
        correctAnswer: q.answer, 
        isCorrect, 
        explanation: q.explanation 
    });
    
    if (isCorrect) { 
        document.getElementById('question-single').classList.add('correct'); 
        score++; 
    } else { 
        document.getElementById('question-single').classList.add('incorrect'); 
    }
    
    explanationElement.style.display = 'block';
    document.querySelectorAll('input[name="questionSingle"]').forEach(inp => inp.disabled = true);
    
    const submitBtn = document.getElementById('submit-single');
    if (currentQuestionIndex < selectedQuestions.length - 1) {
        submitBtn.textContent = 'Next Question';
        submitBtn.onclick = () => { 
            currentQuestionIndex++; 
            showSingleQuestion(); 
        };
    } else {
        submitBtn.textContent = 'View Results';
        submitBtn.onclick = showResults;
    }
}

// --- Submit/Restart ---
submitQuizButton.onclick = checkAnswers;
restartQuizButton.onclick = resetQuiz;
finalRestartButton.onclick = resetQuiz;

// --- Check Answers (all-at-once mode) ---
function checkAnswers() {
    let answeredAll = true;
    userAnswers = [];
    score = 0;
    
    selectedQuestions.forEach((q, idx) => {
        const sel = document.querySelector(`input[name="question${idx}"]:checked`);
        const questionDiv = document.getElementById(`question-${idx}`);
        const explanationDiv = document.getElementById(`explanation-${idx}`);
        let userAnswer = '';
        let isCorrect = false;
        
        if (!sel) {
            answeredAll = false;
            questionDiv.style.border = "2px solid #ffcc00";
            explanationDiv.style.display = 'block';
        } else {
            userAnswer = sel.value;
            isCorrect = userAnswer.replace(/\s+/g, '') === q.answer.replace(/\s+/g, '');
            if (isCorrect) { 
                score++; 
                questionDiv.classList.add('correct'); 
            } else { 
                questionDiv.classList.add('incorrect'); 
            }
            explanationDiv.style.display = 'block';
        }
        
        userAnswers.push({ 
            question: q.question, 
            userAnswer: userAnswer || '<em>No answer</em>', 
            correctAnswer: q.answer, 
            isCorrect, 
            explanation: q.explanation 
        });
    });
    
    if (!answeredAll) { 
        alert('Please answer all questions before submitting!'); 
        return; 
    }
    
    showResults();
}

// --- Show Results ---
function showResults() {
    quizScreen.classList.remove('active-screen');
    resultsScreen.classList.add('active-screen');
    
    const percentage = Math.round((score / selectedQuestions.length) * 100);
    let message = '';
    if (percentage >= 80) message = "Excellent!";
    else if (percentage >= 60) message = "Good job!";
    else if (percentage >= 40) message = "Not bad!";
    else message = "Keep practicing!";
    
    finalScoreContainer.innerHTML = `
        <div>${message}</div>
        <div>You scored ${score} out of ${selectedQuestions.length} (${percentage}%)</div>
    `;
    
    let html = '';
    userAnswers.forEach((ans, idx) => {
        html += `
            <div class="question ${ans.isCorrect ? 'correct' : 'incorrect'}">
                <p><strong>Q${idx+1}: ${ans.question}</strong></p>
                <p>Your answer: ${ans.userAnswer} ${ans.isCorrect ? '✓' : '✗'}</p>
                ${!ans.isCorrect ? `<p>Correct answer: ${ans.correctAnswer}</p>` : ''}
                <p class="explanation show">Explanation: ${ans.explanation}</p>
            </div>
        `;
    });
    resultsContainer.innerHTML = html;
    
    // Scroll to top of results
    resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// --- Reset ---
function resetQuiz() {
    currentQuestionIndex = 0;
    userAnswers = [];
    themeScreen.classList.add('active-screen');
    lengthScreen.classList.remove('active-screen');
    quizScreen.classList.remove('active-screen');
    resultsScreen.classList.remove('active-screen');
    resultsContainer.innerHTML = '';
    finalScoreContainer.textContent = '';
    
    // Reset all selections
    document.querySelectorAll('.selection-option').forEach(opt => opt.classList.remove('selected'));
    document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
}
</script>
</body>
</html>
