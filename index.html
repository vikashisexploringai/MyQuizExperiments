<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Historical Events Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --secondary: #4cc9f0;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        h1, h2 {
            color: var(--primary);
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            background: var(--primary);
            color: white;
            font-size: 1.8rem;
        }

        h2 {
            font-size: 1.5rem;
            padding-bottom: 10px;
        }

        .active-screen {
            display: block;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theme-screen, .length-screen, .quiz-screen, .results-screen {
            display: none;
        }

        .selection-options {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .selection-option {
            position: relative;
        }

        .selection-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .selection-option label {
            display: block;
            padding: 15px;
            background: var(--light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .selection-option input[type="radio"]:checked + label {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .selection-option label:hover {
            background: #e9ecef;
        }

        .theme-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .one-at-a-time-option {
            margin-top: 20px;
            text-align: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            background: var(--primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--gray);
        }

        button.secondary:hover {
            background: #5a6268;
        }

        /* Quiz Screen Styles */
        .progress {
            background: var(--light);
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .question {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            background: white;
            box-shadow: var(--box-shadow);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            position: relative;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .option label {
            display: block;
            padding: 12px 15px 12px 45px;
            background: var(--light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .option label:hover {
            background: #e9ecef;
        }

        .option label::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            transition: var(--transition);
        }

        .option input[type="radio"]:checked + label::before {
            background-color: var(--primary);
            border-color: var(--primary);
            box-shadow: inset 0 0 0 3px white;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            display: none;
        }

        .show {
            display: block !important;
        }

        .correct {
            border-left: 4px solid var(--success);
        }

        .incorrect {
            border-left: 4px solid var(--danger);
        }

        .quiz-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Results Screen */
        .score {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .results {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .results::-webkit-scrollbar {
            width: 8px;
        }

        .results::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .results::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .results .question {
            margin-bottom: 15px;
        }

        .results p {
            margin-bottom: 8px;
        }

        .correct-answer {
            color: var(--success);
            font-weight: 600;
        }

        .user-answer {
            color: var(--danger);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .quiz-container {
                border-radius: 0;
            }
            
            .selection-options {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="quiz-container">
    <h1>Historical Events Quiz</h1>

    <!-- Theme Selection Screen -->
    <div id="theme-screen" class="theme-screen active-screen">
        <h2>Choose Quiz Theme</h2>
        <div class="selection-options" id="theme-options"></div>
        <div class="nav-buttons">
            <button id="next-to-length">Next →</button>
        </div>
    </div>

    <!-- Length Selection Screen -->
    <div id="length-screen" class="length-screen">
        <h2 id="length-screen-title">Choose Quiz Length</h2>
        <div class="selection-options" id="length-options"></div>
        <div class="nav-buttons">
            <button id="back-to-theme" class="secondary">← Back</button>
            <button id="start-quiz">Start Quiz</button>
        </div>
        <div class="one-at-a-time-option">
            <button id="one-at-a-time">One Question At A Time</button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="quiz-screen">
        <div class="progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div id="quiz"></div>
        <div class="quiz-actions">
            <button id="submit-quiz">Submit Quiz</button>
            <button id="restart-quiz" class="secondary">Restart Quiz</button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="results-screen">
        <div class="score" id="final-score"></div>
        <div class="results" id="results"></div>
        <div class="nav-buttons">
            <button id="restart">Take Another Quiz</button>
        </div>
    </div>
</div>

<script>
// --- Theme/JSON Mapping ---
const THEMES = [
    { key: "battles", name: "Battles", description: "Important Battles and Treaties", file: "themes/battles.json" },
    { key: "modernHistory", name: "Modern History", description: "Modern India and World", file: "themes/modernHistory.json" },
    { key: "contemporary", name: "Contemporary India", description: "Post-independence India and World", file: "themes/contemporaryHistory.json" },
];

// --- Quiz State ---
let quizState = {
    selectedThemeKey: null,
    selectedQuestions: [],
    quizMode: 'all',
    currentQuestionIndex: 0,
    userAnswers: [],
    score: 0
};

// --- DOM elements ---
const screens = {
    theme: document.getElementById('theme-screen'),
    length: document.getElementById('length-screen'),
    quiz: document.getElementById('quiz-screen'),
    results: document.getElementById('results-screen')
};

const containers = {
    themeOptions: document.getElementById('theme-options'),
    lengthOptions: document.getElementById('length-options'),
    quiz: document.getElementById('quiz'),
    results: document.getElementById('results'),
    progressBar: document.getElementById('progress-bar'),
    finalScore: document.getElementById('final-score')
};

const buttons = {
    nextToLength: document.getElementById('next-to-length'),
    backToTheme: document.getElementById('back-to-theme'),
    startQuiz: document.getElementById('start-quiz'),
    oneAtATime: document.getElementById('one-at-a-time'),
    submitQuiz: document.getElementById('submit-quiz'),
    restartQuiz: document.getElementById('restart-quiz'),
    restart: document.getElementById('restart')
};

// --- Initialize theme options ---
function initializeThemeOptions() {
    containers.themeOptions.innerHTML = '';
    THEMES.forEach(theme => {
        const div = document.createElement('div');
        div.className = 'selection-option';
        div.innerHTML = `
            <input type="radio" name="quizTheme" value="${theme.key}" id="theme-${theme.key}">
            <label for="theme-${theme.key}">
                <strong>${theme.name}</strong>
                <div class="theme-description">${theme.description}</div>
            </label>
        `;
        containers.themeOptions.appendChild(div);
    });
}

// --- Initialize length options ---
function initializeLengthOptions(questionsCount) {
    containers.lengthOptions.innerHTML = '';
    
    // Create standard length options (10, 20, 30)
    [10, 20, 30].forEach(n => {
        if (n <= questionsCount) {
            const div = document.createElement('div');
            div.className = 'selection-option';
            div.innerHTML = `
                <input type="radio" name="quizLength" value="${n}" id="length-${n}">
                <label for="length-${n}">${n} Questions</label>
            `;
            containers.lengthOptions.appendChild(div);
        }
    });
    
    // Add "Complete Set" option
    const div = document.createElement('div');
    div.className = 'selection-option';
    div.innerHTML = `
        <input type="radio" name="quizLength" value="${questionsCount}" id="length-complete">
        <label for="length-complete">Complete Set (${questionsCount} Questions)</label>
    `;
    containers.lengthOptions.appendChild(div);
    
    // Auto-select the first option
    const firstOption = containers.lengthOptions.querySelector('input[type="radio"]');
    if (firstOption) firstOption.checked = true;
}

// --- Navigation Functions ---
function showScreen(screenName) {
    Object.values(screens).forEach(screen => screen.classList.remove('active-screen'));
    screens[screenName].classList.add('active-screen');
}

// --- Event Listeners ---
buttons.nextToLength.addEventListener('click', async () => {
    const selectedTheme = document.querySelector('input[name="quizTheme"]:checked');
    if (!selectedTheme) {
        alert("Please select a quiz theme!");
        return;
    }
    
    quizState.selectedThemeKey = selectedTheme.value;
    const theme = THEMES.find(t => t.key === quizState.selectedThemeKey);
    
    try {
        const response = await fetch(theme.file);
        const questions = await response.json();
        initializeLengthOptions(questions.length);
        showScreen('length');
    } catch (error) {
        console.error("Error loading questions:", error);
        alert("Failed to load quiz questions. Please try again.");
    }
});

buttons.backToTheme.addEventListener('click', () => {
    showScreen('theme');
});

buttons.startQuiz.addEventListener('click', () => startQuiz('all'));
buttons.oneAtATime.addEventListener('click', () => startQuiz('one'));

buttons.submitQuiz.addEventListener('click', checkAnswers);
buttons.restartQuiz.addEventListener('click', resetQuiz);
buttons.restart.addEventListener('click', resetQuiz);

// --- Quiz Functions ---
async function startQuiz(mode) {
    const selectedLength = document.querySelector('input[name="quizLength"]:checked');
    if (!selectedLength) {
        alert("Please select a quiz length!");
        return;
    }
    
    quizState.quizMode = mode;
    quizState.currentQuestionIndex = 0;
    quizState.userAnswers = [];
    quizState.score = 0;
    
    const theme = THEMES.find(t => t.key === quizState.selectedThemeKey);
    try {
        const response = await fetch(theme.file);
        let questions = await response.json();
        questions = shuffleArray(questions);
        
        const questionCount = parseInt(selectedLength.value);
        quizState.selectedQuestions = questions.slice(0, questionCount);
        
        showScreen('quiz');
        updateProgress();
        renderQuestions();
    } catch (error) {
        console.error("Error starting quiz:", error);
        alert("Failed to start quiz. Please try again.");
    }
}

function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

function updateProgress() {
    const progress = quizState.quizMode === 'one' 
        ? (quizState.currentQuestionIndex + 1) / quizState.selectedQuestions.length * 100
        : 100;
    
    containers.progressBar.style.width = `${progress}%`;
}

function renderQuestions() {
    containers.quiz.innerHTML = '';
    
    if (quizState.quizMode === 'all') {
        renderAllQuestions();
        buttons.submitQuiz.style.display = '';
        buttons.restartQuiz.style.display = '';
    } else {
        renderSingleQuestion();
        buttons.submitQuiz.style.display = 'none';
        buttons.restartQuiz.style.display = '';
    }
}

function renderAllQuestions() {
    let html = '';
    quizState.selectedQuestions.forEach((question, index) => {
        html += `
            <div class="question" id="question-${index}">
                <div class="question-text">${index + 1}. ${question.question}</div>
                <div class="options">
                    ${question.options.map((option, optIndex) => `
                        <div class="option">
                            <input type="radio" name="question-${index}" value="${option}" id="q${index}-opt${optIndex}">
                            <label for="q${index}-opt${optIndex}">${option}</label>
                        </div>
                    `).join('')}
                </div>
                <div class="explanation" id="explanation-${index}">${question.explanation}</div>
            </div>
        `;
    });
    
    containers.quiz.innerHTML = html;
}

function renderSingleQuestion() {
    const question = quizState.selectedQuestions[quizState.currentQuestionIndex];
    const isLastQuestion = quizState.currentQuestionIndex === quizState.selectedQuestions.length - 1;
    
    containers.quiz.innerHTML = `
        <div class="question" id="question-single">
            <div class="question-text">Question ${quizState.currentQuestionIndex + 1} of ${quizState.selectedQuestions.length}: ${question.question}</div>
            <div class="options">
                ${question.options.map((option, optIndex) => `
                    <div class="option">
                        <input type="radio" name="question-single" value="${option}" id="q-single-opt${optIndex}">
                        <label for="q-single-opt${optIndex}">${option}</label>
                    </div>
                `).join('')}
            </div>
            <div class="explanation" id="explanation-single">${question.explanation}</div>
            <div class="nav-buttons" style="margin-top:20px;">
                <button id="submit-single">${isLastQuestion ? 'Finish Quiz' : 'Submit Answer'}</button>
            </div>
        </div>
    `;
    
    document.getElementById('submit-single').addEventListener('click', checkSingleAnswer);
}

function checkSingleAnswer() {
    const selectedOption = document.querySelector('input[name="question-single"]:checked');
    if (!selectedOption) {
        alert('Please select an answer!');
        return;
    }
    
    const question = quizState.selectedQuestions[quizState.currentQuestionIndex];
    const userAnswer = selectedOption.value;
    const isCorrect = userAnswer === question.answer;
    
    quizState.userAnswers.push({
        question: question.question,
        userAnswer,
        correctAnswer: question.answer,
        isCorrect,
        explanation: question.explanation
    });
    
    if (isCorrect) {
        quizState.score++;
        document.getElementById('question-single').classList.add('correct');
    } else {
        document.getElementById('question-single').classList.add('incorrect');
    }
    
    document.getElementById('explanation-single').classList.add('show');
    document.querySelectorAll('input[name="question-single"]').forEach(input => {
        input.disabled = true;
    });
    
    const submitButton = document.getElementById('submit-single');
    if (quizState.currentQuestionIndex < quizState.selectedQuestions.length - 1) {
        submitButton.textContent = 'Next Question →';
        submitButton.onclick = () => {
            quizState.currentQuestionIndex++;
            updateProgress();
            renderQuestions();
        };
    } else {
        submitButton.textContent = 'View Results';
        submitButton.onclick = showResults;
    }
}

function checkAnswers() {
    let allAnswered = true;
    quizState.userAnswers = [];
    quizState.score = 0;
    
    quizState.selectedQuestions.forEach((question, index) => {
        const selectedOption = document.querySelector(`input[name="question-${index}"]:checked`);
        const questionElement = document.getElementById(`question-${index}`);
        const explanationElement = document.getElementById(`explanation-${index}`);
        
        if (!selectedOption) {
            allAnswered = false;
            questionElement.style.borderLeft = "4px solid var(--warning)";
            explanationElement.classList.add('show');
        } else {
            const userAnswer = selectedOption.value;
            const isCorrect = userAnswer === question.answer;
            
            if (isCorrect) {
                quizState.score++;
                questionElement.classList.add('correct');
            } else {
                questionElement.classList.add('incorrect');
            }
            
            explanationElement.classList.add('show');
        }
        
        quizState.userAnswers.push({
            question: question.question,
            userAnswer: selectedOption ? selectedOption.value : "No answer selected",
            correctAnswer: question.answer,
            isCorrect: selectedOption ? selectedOption.value === question.answer : false,
            explanation: question.explanation
        });
    });
    
    if (!allAnswered) {
        alert('Please answer all questions before submitting!');
        return;
    }
    
    showResults();
}

function showResults() {
    showScreen('results');
    containers.finalScore.textContent = `You scored ${quizState.score} out of ${quizState.selectedQuestions.length}`;
    
    let resultsHTML = '';
    quizState.userAnswers.forEach((answer, index) => {
        resultsHTML += `
            <div class="question ${answer.isCorrect ? 'correct' : 'incorrect'}">
                <p><strong>Q${index + 1}: ${answer.question}</strong></p>
                <p>Your answer: <span class="user-answer">${answer.userAnswer}</span> ${answer.isCorrect ? '✓' : '✗'}</p>
                ${!answer.isCorrect ? `<p>Correct answer: <span class="correct-answer">${answer.correctAnswer}</span></p>` : ''}
                <p class="explanation show">${answer.explanation}</p>
            </div>
        `;
    });
    
    containers.results.innerHTML = resultsHTML;
}

function resetQuiz() {
    quizState = {
        selectedThemeKey: null,
        selectedQuestions: [],
        quizMode: 'all',
        currentQuestionIndex: 0,
        userAnswers: [],
        score: 0
    };
    
    showScreen('theme');
    containers.results.innerHTML = '';
    containers.finalScore.textContent = '';
}

// --- Initialize the quiz ---
initializeThemeOptions();
</script>
</body>
</html>
